# Лабораторная работа № 1.1
## Работа с файлами и каталогами

Разработать на языке C для ОС Linux программу, позволяющую выполнять
рекурсивный поиск файлов, начиная с указанного каталога, в соответствии с условием из
Табл. 3 и вариантом из Табл. 4.

Программа должна представлять собой консольную утилиту, настройка работы
которой осуществляется путем передачи аргументов в строке запуска и/или с помощью
переменных окружения (опции необязательны, аргументы каталог и цель_поиска —
обязательны):

```
lab11abcNXXXXX [опции] каталог цель_поиска
```

Программа должна выполнять рекурсивный поиск файлов, отвечающих критерию,
который задается аргументом цель_поиска в соответствии с условием из Табл. 3. При
обнаружении файла, отвечающего заданным критериям поиска, программа должна вывести в
стандартный поток вывода полный путь к этому файлу.

При указании опций `-h` или `-v` (или их "длинных" аналогов `--help` или `--version`)
выполняется вывод информации, заданной опцией, и работа программы завершается. Опции,
которые должны поддерживаться программой, приведены в Табл. 1.

При определении переменной окружения `LAB11DEBUG` в стандартный поток ошибок
должна выводиться информация о том, что и в каком месте файла нашлось (чтобы было
легче понять, почему файл отвечает критериям поиска), а также может выводиться любая
дополнительная отладочная информация. Переменные окружения, которые должны
поддерживаться программой, приведены в Табл. 2.


---
**Замечание 1.** При выполнении лабораторной работы следует использовать функции
стандартной библиотеки С и системные вызовы операционной системы. Использовать С++, а
следовательно, ввод-вывод в стиле С++ (классы `ifstream`/`ofstream`/…), контейнеры и
алгоритмы STL (`<string>`, `<vector>`, `<map>`, ...) запрещено.

**Замечание 2.** В программах должна присутствовать обработка ошибок: в случаях, если
пользователь задал неверную комбинацию опций, указал файлы, которые невозможно
открыть, и т.д. программа должна выдавать диагностическое сообщение на консоль (в
стандартный поток ошибок и/или лог-файл), прежде чем завершиться.

**Замечание 3.** При обходе дерева каталогов нужно учитывать, что доступ к некоторым
файлам и каталогам может завершиться с ошибкой (например, по причине отсутствия прав
доступа и т.д.). В таком случае следует вывести сообщение об ошибке в стандартный поток
ошибок и продолжить обход. Для упрощения реализации обхода символические ссылки (и
аналогичные средства — жесткие ссылки, bind mount'ы и т.д.) можно игнорировать.

**Замечание 4.** Категорически запрещается использовать статические массивы (с размерами,
заданными на этапе компиляции) для любых данных, размер которых зависит от входных
данных или условий запуска. Для хранения таких данных необходимо использовать
динамическую память и определять объем необходимой памяти в зависимости от ситуации.  
Статические массивы можно использовать в тех ситуациях, когда известен максимальный
размер обрабатываемых данных (и он не превышает размеров стека или максимального
размера статических массивов, допускаемого компилятором).

**Замечание 5.** Информационные сообщения выводятся программой в стандартный поток
вывода, сообщения об ошибках — в стандартный поток ошибок. С помощью определения
переменной окружения `LAB11DEBUG` можно включить вывод отладочных сообщений
программой в стандартный поток ошибок.

**Замечание 6.** Для обработки опций командной строки рекомендуется использовать функцию
`getopt_long()`. При необходимости список опций можно расширить.

**Замечание 7.** Несмотря на то, что для компиляции программ необходимо использовать
компилятор gcc, использования расширений GNU C желательно по возможности избегать и
ориентироваться на использование стандарта C11 или более позднего.

**Замечание 8.** Программа должна успешно компилироваться и выполняться в ОС Linux с
ядром версии >= 5.0. По возможности следует избегать специфичных для Linux и glibc
функций и системных вызовов и стремиться к соответствию стандарту POSIX. При желании
и возможности рекомендуется проверить работу программы не только на платформе x86_64
GNU/Linux, но и на других POSIX платформах: x86/ARM/... + \*BSD/macOS/...


---
**Таблица 1.** Опции командной строки, поддерживаемые программой

Опция | Назначение
--- | ---
-v, --version | Вывод версии программы и информации о программе.
-h, --help | Вывод справки по опциям.


**Таблица 2.** Переменные окружения, поддерживаемые программой

Переменная | Назначение
--- | ---
LAB11DEBUG | Включение вывода отладочной информации.


**Таблица 3.** Формат аргумента цель_поиска

1. Выполняется поиск заданной последовательности байтов.
Аргумент цель_поиска имеет формат 0xhh[hh*], где hh —
две шестнадцатеричных цифры (число должно начинаться с
префикса 0x).  
Пример запуска программы:
`./lab11psiN32451 /home 0xc0ffee`
(Начиная с каталога /home, рекурсивно выполняется поиск
файлов, содержащих последовательность байтов 0xc0 (192),
0xff (255) и 0xee (238).)

2. Выполняется поиск заданной последовательности байтов.
Аргумент цель_поиска имеет формат строки в кодировке
UTF-8.  
Пример запуска программы:
`./lab11psiN32451 /home "лавандовый раф"`
(Начиная с каталога /home, рекурсивно выполняется поиск
файлов, содержащих последовательность байтов 0xd0 0xbb
('л'), 0xd0 0xb0 ('а'), ..., 0xd1 0x84('ф').)


**Таблица 4.** Функции, которые необходимо использовать для реализации поиска файлов и каталогов

Вариант | Функции
--- | ---
1 | opendir()/readdir() без рекурсии
2 | opendir()/readdir() с рекурсией
3 | ftw()
4 | nftw()
5 | fts_open()/fts_read()/...
